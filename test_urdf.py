import pybullet as p
import pybullet_data
import time

# 1. ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Physics Server (GUI ‡∏Ñ‡∏∑‡∏≠‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á)
# ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ô‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ p.DIRECT
physicsClient = p.connect(p.GUI) 

# 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°
# ‡πÄ‡∏û‡∏¥‡πà‡∏° path ‡∏Ç‡∏≠‡∏á pybullet_data ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (‡πÄ‡∏ä‡πà‡∏ô plane.urdf) ‡πÄ‡∏à‡∏≠
p.setAdditionalSearchPath(pybullet_data.getDataPath()) 
p.setGravity(0, 0, -9.81) # ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡πÇ‡∏ô‡πâ‡∏°‡∏ñ‡πà‡∏ß‡∏á

# 3. ‡πÇ‡∏´‡∏•‡∏î‡∏û‡∏∑‡πâ‡∏ô
planeId = p.loadURDF("plane.urdf")

# 4. ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
#    - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ path ‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
#    - ‡∏ñ‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå .py ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå urdf/ ‡∏Å‡πá‡πÉ‡∏ä‡πâ path ‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
try:
    # ----------------------------------------------------------------- #
    urdf_path = "urdf/my_robot.urdf"  # << üåü ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Path ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    startPos = [0, 0, 0.5]  # ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á 0.5 ‡πÄ‡∏°‡∏ï‡∏£ (‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏û‡∏∑‡πâ‡∏ô)
    # ----------------------------------------------------------------- #
    
    startOrientation = p.getQuaternionFromEuler([0, 0, 0])
    
    robotId = p.loadURDF(urdf_path, startPos, startOrientation)
    
    print(f"--- ‡πÇ‡∏´‡∏•‡∏î URDF ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ---")
    print(f"Robot ID: {robotId}")

    # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Joint ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏î‡∏π
    num_joints = p.getNumJoints(robotId)
    print(f"‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Joints ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: {num_joints}")
    
    # ‡∏™‡∏£‡πâ‡∏≤‡∏á Dictionary ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡∏ä‡∏∑‡πà‡∏≠ joint ‡πÅ‡∏•‡∏∞ ID ‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡πÜ
    joint_name_to_id = {}
    
    for i in range(num_joints):
        joint_info = p.getJointInfo(robotId, i)
        joint_name = joint_info[1].decode('utf-8')
        joint_name_to_id[joint_name] = i
        print(f"  Joint {i} ({joint_name}): {joint_info[12].decode('utf-8')}") # ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠ Link ‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà
        
    print("\n--- ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ Joints ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÑ‡∏î‡πâ: ---")
    print(joint_name_to_id)


except Exception as e:
    print("--- ‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î URDF! ---")
    print(e)
    p.disconnect()
    exit()


# 5. ‡∏£‡∏±‡∏ô Simulation
print("\n--- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á (‡∏Å‡∏î Ctrl+C ‡πÉ‡∏ô Terminal ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏¢‡∏∏‡∏î) ---")
try:
    while True:
        p.stepSimulation()
        time.sleep(1./240.) # ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏à‡∏£‡∏¥‡∏á (240 Hz)
except KeyboardInterrupt:
    print("\n--- ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á ---")


p.disconnect()